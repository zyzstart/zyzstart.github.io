<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Netty（上） | Michael的小木屋</title><meta name="keywords" content="play hard work hard"><meta name="author" content="Michael"><meta name="copyright" content="Michael"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="IO、网络编程">
<meta property="og:type" content="article">
<meta property="og:title" content="Netty（上）">
<meta property="og:url" content="http://example.com/2023/10/17/Netty1/index.html">
<meta property="og:site_name" content="Michael的小木屋">
<meta property="og:description" content="IO、网络编程">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http:///p9.qhimg.com/t0163fa31dd6351bf12.jpg">
<meta property="article:published_time" content="2023-10-16T16:00:00.000Z">
<meta property="article:modified_time" content="2024-04-12T14:22:04.081Z">
<meta property="article:author" content="Michael">
<meta property="article:tag" content="play hard work hard">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http:///p9.qhimg.com/t0163fa31dd6351bf12.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2023/10/17/Netty1/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Netty（上）',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-04-12 22:22:04'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.2"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/./img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">23</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('http:///p9.qhimg.com/t0163fa31dd6351bf12.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Michael的小木屋</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Netty（上）</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-10-16T16:00:00.000Z" title="发表于 2023-10-17 00:00:00">2023-10-17</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-04-12T14:22:04.081Z" title="更新于 2024-04-12 22:22:04">2024-04-12</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Netty（上）"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h3 id="分布式系列课程-—-Netty应用开发"><a href="#分布式系列课程-—-Netty应用开发" class="headerlink" title="分布式系列课程 — Netty应用开发"></a>分布式系列课程 — Netty应用开发</h3><hr>
<h4 id="1-引言"><a href="#1-引言" class="headerlink" title="1. 引言"></a>1. 引言</h4><h5 id="1-1-什么是Netty"><a href="#1-1-什么是Netty" class="headerlink" title="1.1 什么是Netty"></a>1.1 什么是Netty</h5><blockquote>
<p><a target="_blank" rel="noopener" href="https://netty.io/">https://netty.io/</a></p>
<p>Netty is <em>an asynchronous event-driven network application framework</em><br>for rapid development of maintainable high performance protocol servers &amp; clients.</p>
<p>Netty是一个异步事件驱动的网络应用框架。<br>用于快速开发可维护的高性能协议服务器和客户端。</p>
<p>Netty is a NIO client server framework which enables quick and easy development of network applications such as protocol servers and clients. It greatly simplifies and streamlines network programming such as TCP and UDP socket server.</p>
<p>‘Quick and easy’ doesn’t mean that a resulting application will suffer from a maintainability or a performance issue. Netty has been designed carefully with the experiences earned from the implementation of a lot of protocols such as FTP, SMTP, HTTP, and various binary and text-based legacy protocols. As a result, Netty has succeeded to find a way to achieve ease of development, performance, stability, and flexibility without a compromise.</p>
<p>Netty是一个NIO客户服务器框架，它能够快速和容易地开发网络应用，如协议服务器和客户端。它大大简化和精简了网络编程，如TCP和UDP套接字服务器。</p>
<p>快速和简单 “并不意味着开发出来的应用程序会出现可维护性或性能问题。Netty的设计是经过精心设计的，其经验来自于许多协议的实施，如FTP、SMTP、HTTP以及各种基于二进制和文本的遗留协议。因此，Netty成功地找到了一种方法来实现开发的简易性、性能、稳定性和灵活性，而没有任何妥协。</p>
</blockquote>
<h5 id="1-2-为什么要学习Netty"><a href="#1-2-为什么要学习Netty" class="headerlink" title="1.2 为什么要学习Netty"></a>1.2 为什么要学习Netty</h5><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1.</span> Netty已经是行业内网络通信编程的标准，广泛应用于通信领域和很多其他中间件技术的底层。</span><br><span class="line"> </span><br><span class="line"><span class="bullet">2.</span> 应用非常广泛</span><br><span class="line"><span class="bullet">   1.</span> 游戏行业</span><br><span class="line"><span class="bullet">   2.</span> 很多框架的通信底层，解决进程间通信。</span><br><span class="line"><span class="code">      Spring WebFlux、storm、rocketMQ、dubbo等，是分布式系统，通信的核心。</span></span><br></pre></td></tr></table></figure>

<h4 id="2-NIO编程"><a href="#2-NIO编程" class="headerlink" title="2. NIO编程"></a>2. NIO编程</h4><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1.</span> NIO全称成为None Blocking IO (非阻塞IO)。【JDK1.4】</span><br><span class="line"><span class="bullet">2.</span> 非阻塞 主要应用在网络通信中，能够合理利用资源，提高系统的并发效率。支持高并发的系统访问。</span><br></pre></td></tr></table></figure>

<h5 id="2-1-传统网络通信中的开发方式及问题"><a href="#2-1-传统网络通信中的开发方式及问题" class="headerlink" title="2.1 传统网络通信中的开发方式及问题"></a>2.1 传统网络通信中的开发方式及问题</h5><h6 id="2-1-1-多线程版网络编程"><a href="#2-1-1-多线程版网络编程" class="headerlink" title="2.1.1 多线程版网络编程"></a>2.1.1 多线程版网络编程</h6><p><img src="https://cdn.jsdelivr.net/gh/zyzstart/picgodemo/img/image-20240412203006702.png" alt="image-20240412203006702"></p>
<h6 id="2-1-2-线程池版的网络编程"><a href="#2-1-2-线程池版的网络编程" class="headerlink" title="2.1.2 线程池版的网络编程"></a>2.1.2 线程池版的网络编程</h6><p><img src="https://cdn.jsdelivr.net/gh/zyzstart/picgodemo/img/image-20240412203022475.png" alt="image-20240412203022475"></p>
<h5 id="2-2-NIO网络通信中的非阻塞编程"><a href="#2-2-NIO网络通信中的非阻塞编程" class="headerlink" title="2.2 NIO网络通信中的非阻塞编程"></a>2.2 NIO网络通信中的非阻塞编程</h5><p><img src="https://cdn.jsdelivr.net/gh/zyzstart/picgodemo/img/image-20240412203033490.png" alt="image-20240412203033490"></p>
<h4 id="3-NIO的基本开发方式"><a href="#3-NIO的基本开发方式" class="headerlink" title="3.NIO的基本开发方式"></a>3.NIO的基本开发方式</h4><h6 id="3-1-Channel简介"><a href="#3-1-Channel简介" class="headerlink" title="3.1 Channel简介"></a>3.1 Channel简介</h6><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1.</span> IO通信的通道，类似于InputStream、OutputStream</span><br><span class="line"><span class="bullet">2.</span> Channel没有方向性</span><br></pre></td></tr></table></figure>

<ul>
<li><p>常见Channel</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1.</span> 文件操作</span><br><span class="line">   FileChannel，读写文件中的数据。</span><br><span class="line"><span class="bullet">2.</span> 网络操作</span><br><span class="line">   SocketChannel，通过TCP读写网络中的数据。</span><br><span class="line">   ServerSockectChannel，监听新进来的TCP连接，像Web服务器那样。对每一个新进来的连接都会创建一个SocketChannel。</span><br><span class="line">   DatagramChannel，通过UDP读写网络中的数据。</span><br></pre></td></tr></table></figure></li>
<li><p>获得方式</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1.</span> FileInputStreanm/FileOutputStream</span><br><span class="line"><span class="bullet">2.</span> RandomAccessFile</span><br><span class="line"></span><br><span class="line"><span class="bullet">3.</span> Socket</span><br><span class="line"><span class="bullet">4.</span> ServerSocket</span><br><span class="line"><span class="bullet">5.</span> DatagramSocket</span><br></pre></td></tr></table></figure></li>
</ul>
<h6 id="3-2-Buffer简介"><a href="#3-2-Buffer简介" class="headerlink" title="3.2 Buffer简介"></a>3.2 Buffer简介</h6><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1.</span> Channel读取或者写入的数据，都要写到Buffer中，才可以被程序操作。</span><br><span class="line"><span class="bullet">2.</span> 因为Channel没有方向性，所以Buffer为了区分读写，引入了读模式、写模式进行区分。</span><br></pre></td></tr></table></figure>

<ul>
<li><p>常见Buffer</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1.</span> ByteBuffer</span><br><span class="line"><span class="bullet">2.</span> CharBuffer</span><br><span class="line"><span class="bullet">3.</span> DoubleBuffer</span><br><span class="line"><span class="bullet">4.</span> FloatBuffer</span><br><span class="line"><span class="bullet">5.</span> IntBuffer</span><br><span class="line"><span class="bullet">6.</span> LongBuffer</span><br><span class="line"><span class="bullet">7.</span> ShortBuffer</span><br><span class="line"><span class="bullet">8.</span> MappedByteBuffer..</span><br></pre></td></tr></table></figure></li>
<li><p>获得方式</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1.</span> ByteBuffer.allocate(10);</span><br><span class="line"><span class="bullet">2.</span> encode()</span><br></pre></td></tr></table></figure></li>
</ul>
<h6 id="3-4-第一个NIO程序分析"><a href="#3-4-第一个NIO程序分析" class="headerlink" title="3.4 第一个NIO程序分析"></a>3.4 第一个NIO程序分析</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestNIO1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//1 创建Channel通道  FileChannel</span></span><br><span class="line">        <span class="type">FileChannel</span> <span class="variable">channel</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;/Users/sunshuai/Develop/code/java/idea/netty-proj-lession/netty-basic-01/data.txt&quot;</span>).getChannel();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2 创建缓冲区</span></span><br><span class="line">        <span class="comment">//1234567890</span></span><br><span class="line">        <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="comment">//3把通道内获取的文件数据，写入缓冲区</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">read</span> <span class="operator">=</span> channel.read(buffer);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (read == -<span class="number">1</span>) <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//4.程序读取buffer内容，后续的操作。设置buffer为读模式。</span></span><br><span class="line">            buffer.flip();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//5.循环读取缓冲区中的数据</span></span><br><span class="line">            <span class="keyword">while</span> (buffer.hasRemaining()) &#123;</span><br><span class="line">                <span class="type">byte</span> <span class="variable">b</span> <span class="operator">=</span> buffer.get();</span><br><span class="line">                System.out.println(<span class="string">&quot;(char)b = &quot;</span> + (<span class="type">char</span>) b);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//6. 设置buffer的写模式</span></span><br><span class="line">            buffer.clear();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestNIO2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//RadomAccessFile 异常处理</span></span><br><span class="line">        <span class="type">FileChannel</span> <span class="variable">channel</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            channel = <span class="keyword">new</span> <span class="title class_">RandomAccessFile</span>(<span class="string">&quot;/Users/sunshuai/Develop/code/java/idea/netty-proj-lession/netty-basic-01/data.txt&quot;</span>, <span class="string">&quot;rw&quot;</span>).getChannel();</span><br><span class="line"></span><br><span class="line">            <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">read</span> <span class="operator">=</span> channel.read(buffer);</span><br><span class="line">                <span class="keyword">if</span> (read == -<span class="number">1</span>) <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">                buffer.flip();</span><br><span class="line">                <span class="keyword">while</span> (buffer.hasRemaining()) &#123;</span><br><span class="line">                    <span class="type">byte</span> <span class="variable">b</span> <span class="operator">=</span> buffer.get();</span><br><span class="line">                    System.out.println(<span class="string">&quot;(char) b = &quot;</span> + (<span class="type">char</span>) b);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                buffer.clear();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (channel != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    channel.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestNIO3</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> (<span class="type">FileChannel</span> <span class="variable">channel</span> <span class="operator">=</span> FileChannel.open(Paths.get(<span class="string">&quot;/Users/sunshuai/Develop/code/java/idea/netty-proj-lession/netty-basic-01/data.txt&quot;</span>), StandardOpenOption.READ);) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">10</span>);</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">read</span> <span class="operator">=</span> channel.read(buffer);</span><br><span class="line">                <span class="keyword">if</span> (read == -<span class="number">1</span>) <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">                buffer.flip();</span><br><span class="line">                <span class="keyword">while</span> (buffer.hasRemaining()) &#123;</span><br><span class="line">                    <span class="type">byte</span> <span class="variable">b</span> <span class="operator">=</span> buffer.get();</span><br><span class="line">                    System.out.println(<span class="string">&quot;(char)b = &quot;</span> + (<span class="type">char</span>) b);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                buffer.clear();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h6 id="3-5-NIO开发的步骤总结"><a href="#3-5-NIO开发的步骤总结" class="headerlink" title="3.5 NIO开发的步骤总结"></a>3.5 NIO开发的步骤总结</h6><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1.</span> 获取Channel </span><br><span class="line"><span class="bullet">2.</span> 创建Buffer</span><br><span class="line"><span class="bullet">3.</span> 循环的从Channel中获取数据，读入到Buffer中。进行操作.</span><br><span class="line"><span class="code">    channel.read(buffer);</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">    buffer.flip();//设置读模式</span></span><br><span class="line"><span class="code">    循环从buffer中获取数据。</span></span><br><span class="line"><span class="code">    buffer.get();</span></span><br><span class="line"><span class="code">    buffer.clear();//设置写模式</span></span><br></pre></td></tr></table></figure>

<h4 id="4-ByteBuffer详解"><a href="#4-ByteBuffer详解" class="headerlink" title="4. ByteBuffer详解"></a>4. ByteBuffer详解</h4><h5 id="4-1-ByteBuffer是抽象类，他的主要实现类为"><a href="#4-1-ByteBuffer是抽象类，他的主要实现类为" class="headerlink" title="4.1 ByteBuffer是抽象类，他的主要实现类为"></a>4.1 ByteBuffer是抽象类，他的主要实现类为</h5><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1.</span> HeapByteBuffer    堆ByteBuffer        JVM内的堆内存  ---&gt;  读写操作 效率低 会收到GC影响 </span><br><span class="line"><span class="bullet">2.</span> MappedByteBuffer(DirectByteBuffer)    OS内存        ---&gt;   读写操作 效率高 不会收到GC影响 。 不主动析构，会造成内存的泄露  </span><br></pre></td></tr></table></figure>

<h5 id="4-2-获取方式"><a href="#4-2-获取方式" class="headerlink" title="4.2 获取方式"></a>4.2 获取方式</h5><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1.</span> ByteBuffer.allocate(10);//一旦分配空间，不可以动态调整</span><br><span class="line"><span class="bullet">2.</span> encode()</span><br></pre></td></tr></table></figure>

<h5 id="4-3-核心结构"><a href="#4-3-核心结构" class="headerlink" title="4.3 核心结构"></a>4.3 核心结构</h5><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ByteBuffer是一个类似数组的结构，整个结构中包含三个主要的状态</span><br><span class="line"><span class="bullet">1.</span> Capacity </span><br><span class="line">   buffer的容量，类似于数组的size</span><br><span class="line"><span class="bullet">2.</span> Position</span><br><span class="line">   buffer当前缓存的下标，在读取操作时记录读到了那个位置，在写操作时记录写到了那个位置。从0开始，每读取一次，下标+1</span><br><span class="line"><span class="bullet">3.</span> Limit</span><br><span class="line">   读写限制，在读操作时，设置了你能读多少字节的数据，在写操作时，设置了你还能写多少字节的数据</span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line">所谓的读写模式，本质上就是这几个状态的变化。主要有Position和Limit联合决定了Buffer的读写数据区域。</span><br></pre></td></tr></table></figure>

<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">最后总结一下</span><br><span class="line">写入Buffer数据之前要设置写模式</span><br><span class="line"><span class="bullet">1.</span> 写模式</span><br><span class="line"><span class="bullet">   1.</span> 新创建的Buffer自动是写模式</span><br><span class="line"><span class="bullet">   2.</span> 调用了clear,compact方法</span><br><span class="line">   </span><br><span class="line">读取Buffer数据之前要设置读模式</span><br><span class="line"><span class="bullet">2.</span> 读模式</span><br><span class="line"><span class="bullet">   1.</span> 调用flip方法</span><br></pre></td></tr></table></figure>

<h5 id="4-4-核心API"><a href="#4-4-核心API" class="headerlink" title="4.4 核心API"></a>4.4 核心API</h5><ul>
<li><p>buffer中写入数据[写模式  创建一个bytebuffer ,clear(),compact()]</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1.</span> channel的read方法</span><br><span class="line">   channel.read(buffer)</span><br><span class="line"><span class="bullet">2.</span> buffer的put方法</span><br><span class="line">   buffer.put(byte)    buffer.put((byte)&#x27;a&#x27;)..</span><br><span class="line">   buffer.put(byte[])</span><br></pre></td></tr></table></figure></li>
<li><p>从buffer中读出数据</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1.</span> channel的write方法</span><br><span class="line"></span><br><span class="line"><span class="bullet">2.</span> buffer的get方法 //每调用一次get方法会影响，position的位置。</span><br><span class="line"></span><br><span class="line"><span class="bullet">3.</span> rewind方法(手风琴)，可以将postion重置成0 ，用于复读数据。</span><br><span class="line"></span><br><span class="line"><span class="bullet">4.</span> mark&amp;reset方法，通过mark方法进行标记（position），通过reset方法跳回标记，从新执行.</span><br><span class="line"></span><br><span class="line"><span class="bullet">5.</span> get(i) 方法，获取特定position上的数据，但是不会对position的位置产生影响。</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="4-5-字符串操作"><a href="#4-5-字符串操作" class="headerlink" title="4.5 字符串操作"></a>4.5 字符串操作</h5><ul>
<li><h1 id="字符串存储到Buffer中"><a href="#字符串存储到Buffer中" class="headerlink" title="字符串存储到Buffer中"></a>字符串存储到Buffer中</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">10</span>);</span><br><span class="line">buffer.put(<span class="string">&quot;sunshuai&quot;</span>.getBytes());</span><br><span class="line"></span><br><span class="line">buffer.flip();</span><br><span class="line"><span class="keyword">while</span> (buffer.hasRemaining()) &#123;</span><br><span class="line">  System.out.println(<span class="string">&quot;buffer.get() = &quot;</span> + (<span class="type">char</span>)buffer.get());</span><br><span class="line">&#125;</span><br><span class="line">buffer.clear();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> Charset.forName(<span class="string">&quot;UTF-8&quot;</span>).encode(<span class="string">&quot;sunshuai&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>、encode方法自动 把字符串按照字符集编码后，存储在ByteBuffer.</span><br><span class="line"><span class="number">2</span>、自动把ByteBuffer设置成读模式，且不能手工调用flip方法。</span><br><span class="line"></span><br><span class="line"><span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> StandardCharsets.UTF_8.encode(<span class="string">&quot;sunshuai&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (buffer.hasRemaining()) &#123;</span><br><span class="line">  System.out.println(<span class="string">&quot;buffer.get() = &quot;</span> + (<span class="type">char</span>) buffer.get());</span><br><span class="line">&#125;</span><br><span class="line">buffer.clear();</span><br><span class="line"><span class="number">1</span>、encode方法自动 把字符串按照字符集编码后，存储在ByteBuffer.</span><br><span class="line"><span class="number">2</span>、自动把ByteBuffer设置成读模式，且不能手工调用flip方法。</span><br><span class="line">  </span><br><span class="line"><span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.wrap(<span class="string">&quot;sunshuai&quot;</span>.getBytes());</span><br><span class="line"><span class="keyword">while</span> (buffer.hasRemaining()) &#123;</span><br><span class="line">  System.out.println(<span class="string">&quot;buffer.get() = &quot;</span> + (<span class="type">char</span>) buffer.get());</span><br><span class="line">&#125;</span><br><span class="line">buffer.clear();</span><br></pre></td></tr></table></figure></li>
<li><p>Buffer中的数据转换成字符串</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">10</span>);</span><br><span class="line">buffer.put(<span class="string">&quot;孙&quot;</span>.getBytes());</span><br><span class="line"></span><br><span class="line">buffer.flip();</span><br><span class="line"><span class="type">CharBuffer</span> <span class="variable">result</span> <span class="operator">=</span> StandardCharsets.UTF_8.decode(buffer);</span><br><span class="line">System.out.println(<span class="string">&quot;result.toString() = &quot;</span> + result.toString());</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="4-6-粘包与半包"><a href="#4-6-粘包与半包" class="headerlink" title="4.6 粘包与半包"></a>4.6 粘包与半包</h5><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1.</span> \n 作为分割符，进行行的区分。</span><br><span class="line"><span class="bullet">2.</span> compact进行处理，把第一次没有读取完的数据，向前移动和后面的内容进行整合。</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1. 半包 粘包</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestNIO10</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">50</span>);</span><br><span class="line">        buffer.put(<span class="string">&quot;Hi sunshuai\nl love y&quot;</span>.getBytes());</span><br><span class="line">        doLineSplit(buffer);</span><br><span class="line">        buffer.put(<span class="string">&quot;ou\nDo you like me?\n&quot;</span>.getBytes());</span><br><span class="line">        doLineSplit(buffer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ByteBuffer接受的数据 \n</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">doLineSplit</span><span class="params">(ByteBuffer buffer)</span> &#123;</span><br><span class="line">        buffer.flip();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; buffer.limit(); i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (buffer.get(i) == <span class="string">&#x27;\n&#x27;</span>) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> i + <span class="number">1</span> - buffer.position();</span><br><span class="line">                <span class="type">ByteBuffer</span> <span class="variable">target</span> <span class="operator">=</span> ByteBuffer.allocate(length);</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; length; j++) &#123;</span><br><span class="line">                    target.put(buffer.get());</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">//截取工作完成</span></span><br><span class="line">                target.flip();</span><br><span class="line">                System.out.println(<span class="string">&quot;StandardCharsets.UTF_8.decode(target).toString() = &quot;</span> + StandardCharsets.UTF_8.decode(target).toString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        buffer.compact();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-NIO的开发使用"><a href="#5-NIO的开发使用" class="headerlink" title="5. NIO的开发使用"></a>5. NIO的开发使用</h4><h5 id="5-1-文件操作"><a href="#5-1-文件操作" class="headerlink" title="5.1 文件操作"></a>5.1 文件操作</h5><h6 id="5-1-1-读取文件内容"><a href="#5-1-1-读取文件内容" class="headerlink" title="5.1.1 读取文件内容"></a>5.1.1 读取文件内容</h6><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1.</span> 第一个程序 读文件的内容，读Buffer---&gt; String ----&gt;程序中使用了</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestNIO1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//1 创建Channel通道  FileChannel</span></span><br><span class="line">        <span class="type">FileChannel</span> <span class="variable">channel</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;/Users/sunshuai/Develop/code/java/idea/netty-proj-lession/netty-basic-01/data.txt&quot;</span>).getChannel();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2 创建缓冲区</span></span><br><span class="line">        <span class="comment">//1234567890</span></span><br><span class="line">        <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="comment">//3把通道内获取的文件数据，写入缓冲区</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">read</span> <span class="operator">=</span> channel.read(buffer);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (read == -<span class="number">1</span>) <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//4.程序读取buffer内容，后续的操作。设置buffer为读模式。</span></span><br><span class="line">            buffer.flip();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//5.循环读取缓冲区中的数据</span></span><br><span class="line">            <span class="keyword">while</span> (buffer.hasRemaining()) &#123;</span><br><span class="line">                <span class="type">byte</span> <span class="variable">b</span> <span class="operator">=</span> buffer.get();</span><br><span class="line">                System.out.println(<span class="string">&quot;(char)b = &quot;</span> + (<span class="type">char</span>) b);</span><br><span class="line">            &#125;</span><br><span class="line">          </span><br><span class="line">            <span class="comment">//Charset.forName(&quot;UTF-8&quot;).decode(buffer).toString ---&gt; String</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//6. 设置buffer的写模式</span></span><br><span class="line">            buffer.clear();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="5-1-2-写入文件内容"><a href="#5-1-2-写入文件内容" class="headerlink" title="5.1.2 写入文件内容"></a>5.1.2 写入文件内容</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestNIO11</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//1 获得Channel  FileOutputStream, RandomAccessFile</span></span><br><span class="line">        <span class="type">FileChannel</span> <span class="variable">channel</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;data1&quot;</span>).getChannel();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2 获得Buffer</span></span><br><span class="line">        <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> Charset.forName(<span class="string">&quot;UTF-8&quot;</span>).encode(<span class="string">&quot;sunshuai&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3write</span></span><br><span class="line">        channel.write(buffer);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h6 id="5-1-3-文件的复制"><a href="#5-1-3-文件的复制" class="headerlink" title="5.1.3 文件的复制"></a>5.1.3 文件的复制</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestNIO12</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//data---data2</span></span><br><span class="line">      <span class="comment">/*  FileInputStream inputStream = new FileInputStream(&quot;/Users/sunshuai/Develop/code/java/idea/netty-proj-lession/netty-basic-01/data.txt&quot;);</span></span><br><span class="line"><span class="comment">        FileOutputStream fileOutputStream = new FileOutputStream(&quot;/Users/sunshuai/Develop/code/java/idea/netty-proj-lession/netty-basic-01/data2.txt&quot;);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        byte[] buffer = new byte[1024];</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        while (true) &#123;</span></span><br><span class="line"><span class="comment">            int read = inputStream.read(buffer);</span></span><br><span class="line"><span class="comment">            if (read == -1) break;</span></span><br><span class="line"><span class="comment">            fileOutputStream.write(buffer, 0, read);</span></span><br><span class="line"><span class="comment">        &#125;*/</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">/* FileInputStream inputStream = new FileInputStream(&quot;/Users/sunshuai/Develop/code/java/idea/netty-proj-lession/netty-basic-01/data.txt&quot;);</span></span><br><span class="line"><span class="comment">        FileOutputStream fileOutputStream = new FileOutputStream(&quot;/Users/sunshuai/Develop/code/java/idea/netty-proj-lession/netty-basic-01/data2.txt&quot;);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        IOUtils.copy(inputStream,fileOutputStream);*/</span></span><br><span class="line"></span><br><span class="line">        <span class="type">FileChannel</span> <span class="variable">from</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;/Users/sunshuai/Develop/code/java/idea/netty-proj-lession/netty-basic-01/data.txt&quot;</span>).getChannel();</span><br><span class="line">        <span class="type">FileChannel</span> <span class="variable">to</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;/Users/sunshuai/Develop/code/java/idea/netty-proj-lession/netty-basic-01/data2.txt&quot;</span>).getChannel();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//传输数据上线的 2G-1</span></span><br><span class="line">        <span class="comment">// 若果实际文件大小就是超过2G 如何进行文件的copy</span></span><br><span class="line">        <span class="comment">//from.transferTo(0, from.size(), to);</span></span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">left</span> <span class="operator">=</span> from.size();</span><br><span class="line">        <span class="keyword">while</span> (left &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            left = left - from.transferTo(from.size()-left, left, to);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="5-2-网络编程"><a href="#5-2-网络编程" class="headerlink" title="5.2 网络编程"></a>5.2 网络编程</h5><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1.</span> 服务端 接受请求 ---》  ServerScoketChannel</span><br><span class="line"></span><br><span class="line"><span class="bullet">2.</span> 进行实际通信          ScoketChannel </span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">通过这版代码 证明了 服务器端 存在<span class="number">2</span>中阻塞</span><br><span class="line"><span class="number">1.</span> 连接阻塞 ----&gt;  accept方法存在阻塞---&gt; ServerSocketChannel阻塞。 </span><br><span class="line"><span class="number">2.</span> IO阻塞   ----&gt; channel的read方法存在阻塞---&gt; SocketChannel阻塞。</span><br><span class="line">上述分析 对应着的<span class="number">2</span>个问题。</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyServer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//1. 创建ServerScoketChannel</span></span><br><span class="line">        <span class="type">ServerSocketChannel</span> <span class="variable">serverSocketChannel</span> <span class="operator">=</span> ServerSocketChannel.open();</span><br><span class="line">        <span class="comment">//2. 设置服务端的监听端口：---》client通过网络进行访问 ip:port http://localhost:8989</span></span><br><span class="line">        serverSocketChannel.bind(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(<span class="number">8000</span>));</span><br><span class="line"></span><br><span class="line">        List&lt;SocketChannel&gt; channelList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">20</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. 接受client的连接</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="comment">//4. ScoketChannle 代表 服务端与Client链接的一个通道</span></span><br><span class="line">            System.out.println(<span class="string">&quot;等待连接服务器...&quot;</span>);</span><br><span class="line">            <span class="type">SocketChannel</span> <span class="variable">socketChannel</span> <span class="operator">=</span> serverSocketChannel.accept();<span class="comment">//阻塞 程序等待client</span></span><br><span class="line">            System.out.println(<span class="string">&quot;服务器已经连接...&quot;</span>+socketChannel);</span><br><span class="line"></span><br><span class="line">            channelList.add(socketChannel);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//5. client与服务端 通信过程 NIO代码</span></span><br><span class="line">            <span class="keyword">for</span> (SocketChannel channel : channelList) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;开始实际的数据通信....&quot;</span>);</span><br><span class="line">                channel.read(buffer);<span class="comment">//阻塞 对应的IO通信的阻塞</span></span><br><span class="line">                buffer.flip();</span><br><span class="line">                <span class="type">CharBuffer</span> <span class="variable">decode</span> <span class="operator">=</span> Charset.forName(<span class="string">&quot;UTF-8&quot;</span>).decode(buffer);</span><br><span class="line">                System.out.println(<span class="string">&quot;decode.toString() = &quot;</span> + decode.toString());</span><br><span class="line">                buffer.clear();</span><br><span class="line">                System.out.println(<span class="string">&quot;通信已经结束....&quot;</span>);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">Seletor循环监听事件的方式 解决死循环空转的问题。</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyServer2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ServerSocketChannel</span> <span class="variable">serverSocketChannel</span> <span class="operator">=</span> ServerSocketChannel.open();</span><br><span class="line">        serverSocketChannel.bind(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(<span class="number">8000</span>));</span><br><span class="line">        serverSocketChannel.configureBlocking(<span class="literal">false</span>);<span class="comment">//Selector 只有在非阻塞的情况下 才可以使用。</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//引入监管者</span></span><br><span class="line">        <span class="type">Selector</span> <span class="variable">selector</span> <span class="operator">=</span> Selector.open();<span class="comment">//1. 工厂，2. 单例</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//监管者 管理谁？ selector.xxxx(ssc); //管理者 ssc  ---&gt; Accept</span></span><br><span class="line">        <span class="type">SelectionKey</span> <span class="variable">selectionKey</span> <span class="operator">=</span> serverSocketChannel.register(selector, <span class="number">0</span>, <span class="literal">null</span>);</span><br><span class="line">        <span class="comment">// selector监控 SSC ACCEPT</span></span><br><span class="line">        <span class="comment">// selector</span></span><br><span class="line">        <span class="comment">//   keys --&gt; HashSet</span></span><br><span class="line">        <span class="comment">//  register注册 ssc</span></span><br><span class="line">        selectionKey.interestOps(SelectionKey.OP_ACCEPT);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;MyServler2.main&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//监控</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            selector.select();<span class="comment">//等待.只有监控到了 有实际的连接 或者 读写操作 ，才会处理。</span></span><br><span class="line">            <span class="comment">//对应的 有ACCEPT状态的SSC 和 READ WRITE状态的 SC 存起来</span></span><br><span class="line">            <span class="comment">// SelectionsKeys HashSet</span></span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;-------------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">            Iterator&lt;SelectionKey&gt; iterator = selector.selectedKeys().iterator();</span><br><span class="line">            <span class="keyword">while</span> (iterator.hasNext()) &#123;<span class="comment">//ServerSocketChannel ScoketChannel</span></span><br><span class="line">                <span class="type">SelectionKey</span> <span class="variable">key</span> <span class="operator">=</span> iterator.next();</span><br><span class="line">                <span class="comment">//用完之后 就要把他从SelectedKeys集合中删除掉。问题？ ServerScoketChannel---SelectedKeys删除 ，后续 SSC建立新的连接？</span></span><br><span class="line">                iterator.remove();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (key.isAcceptable()) &#123;</span><br><span class="line">                    <span class="comment">//serverSocketChannel.accept();</span></span><br><span class="line">                    <span class="type">ServerSocketChannel</span> <span class="variable">channel</span> <span class="operator">=</span> (ServerSocketChannel) key.channel();</span><br><span class="line">                    <span class="type">SocketChannel</span> <span class="variable">sc</span> <span class="operator">=</span> channel.accept();</span><br><span class="line">                    sc.configureBlocking(<span class="literal">false</span>);</span><br><span class="line">                    <span class="comment">//监控sc状态 ---&gt; keys</span></span><br><span class="line">                    <span class="type">SelectionKey</span> <span class="variable">sckey</span> <span class="operator">=</span> sc.register(selector, <span class="number">0</span>, <span class="literal">null</span>);</span><br><span class="line">                    sckey.interestOps(SelectionKey.OP_READ);</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (key.isReadable()) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="type">SocketChannel</span> <span class="variable">sc</span> <span class="operator">=</span> (SocketChannel) key.channel();</span><br><span class="line">                        <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">5</span>);</span><br><span class="line">                        <span class="type">int</span> <span class="variable">read</span> <span class="operator">=</span> sc.read(buffer);</span><br><span class="line">                        <span class="keyword">if</span> (read == -<span class="number">1</span>) &#123;</span><br><span class="line">                            key.cancel();</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            buffer.flip();</span><br><span class="line">                            System.out.println(<span class="string">&quot;Charset.defaultCharset().decode(buffer).toString() = &quot;</span> + Charset.defaultCharset().decode(buffer).toString());</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                        key.cancel();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iterator.remove()</span><br><span class="line">把用过的SelectionKey从SeletionKeys集合中剔除</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">selectionKey.cancle();</span><br><span class="line">把一些无法实际解决的内容，通过cancle（）来取消。避免每一次都被select()获取到从新进行循环过程。</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">读取数据</span><br><span class="line"><span class="number">1.</span> 通过附件的形式，把byteBuffer和channel进行了绑定，从而可以多次处理数据。</span><br><span class="line"><span class="number">2.</span> ByteBuffer的扩容。</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">数据的写出 </span><br><span class="line"><span class="number">1.</span> 第一个问题 写一次数据，当发现数据没有写完，设置WRITE监听状态。</span><br><span class="line"><span class="number">2.</span> 每一次发生Write的状态，都把剩下的数据写出去。</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line">主从reactor模式</span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReactorBossServer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">log</span> <span class="operator">=</span> LoggerFactory.getLogger(ReactorBossServer.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, InterruptedException &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;boss thread start ....&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">ServerSocketChannel</span> <span class="variable">ssc</span> <span class="operator">=</span> ServerSocketChannel.open();</span><br><span class="line">        ssc.configureBlocking(<span class="literal">false</span>);</span><br><span class="line">        ssc.bind(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(<span class="number">8000</span>));</span><br><span class="line"></span><br><span class="line">        <span class="type">Selector</span> <span class="variable">selector</span> <span class="operator">=</span> Selector.open();</span><br><span class="line">        ssc.register(selector, SelectionKey.OP_ACCEPT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//模拟多线程的环境，在实际开发中，还是要使用线程池</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        Worker worker = new Worker(&quot;worker1&quot;);</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line"></span><br><span class="line">        Worker[] workers = <span class="keyword">new</span> <span class="title class_">Worker</span>[<span class="number">2</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; workers.length; i++) &#123;</span><br><span class="line">            workers[i] = <span class="keyword">new</span> <span class="title class_">Worker</span>(<span class="string">&quot;worker - &quot;</span> + i);<span class="comment">//worker-0 worker-1</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">AtomicInteger</span> <span class="variable">index</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            selector.select();</span><br><span class="line"></span><br><span class="line">            Iterator&lt;SelectionKey&gt; iterator = selector.selectedKeys().iterator();</span><br><span class="line">            <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">                <span class="type">SelectionKey</span> <span class="variable">sscSelectionKey</span> <span class="operator">=</span> iterator.next();</span><br><span class="line">                iterator.remove();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (sscSelectionKey.isAcceptable()) &#123;</span><br><span class="line">                    <span class="type">SocketChannel</span> <span class="variable">sc</span> <span class="operator">=</span> ssc.accept();</span><br><span class="line">                    sc.configureBlocking(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">//sc.register(selector, SelectionKey.OP_READ);</span></span><br><span class="line">                    log.debug(<span class="string">&quot;boss invoke worker register ...&quot;</span>);</span><br><span class="line">                    <span class="comment">//worker-0 worker-1 worker-0 worker-1</span></span><br><span class="line">                    <span class="comment">//hash取摸    x%2= 0  1 [0,1,0,1]</span></span><br><span class="line">                    workers[index.getAndIncrement()% workers.length].register(sc);</span><br><span class="line">                    log.debug(<span class="string">&quot;boss invoked worker register&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Worker</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">log</span> <span class="operator">=</span> LoggerFactory.getLogger(Worker.class);</span><br><span class="line">    <span class="keyword">private</span> Selector selector;</span><br><span class="line">    <span class="keyword">private</span> Thread thread;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="type">boolean</span> isCreated;<span class="comment">//false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ConcurrentLinkedQueue&lt;Runnable&gt; runnables = <span class="keyword">new</span> <span class="title class_">ConcurrentLinkedQueue</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">//构造方法</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//为什么不好？</span></span><br><span class="line">    <span class="comment">//Select Thread</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Worker</span><span class="params">(String name)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">       <span class="comment">/* thread = new Thread(this, name);</span></span><br><span class="line"><span class="comment">        thread.start();</span></span><br><span class="line"><span class="comment">        selector = Selector.open();*/</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//线程的任务</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">register</span><span class="params">(SocketChannel sc)</span> <span class="keyword">throws</span> IOException, InterruptedException &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;worker register invoke....&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!isCreated) &#123;</span><br><span class="line">            thread = <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="built_in">this</span>, name);</span><br><span class="line">            thread.start();</span><br><span class="line">            selector = Selector.open();</span><br><span class="line">            isCreated = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        runnables.add(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                sc.register(selector, SelectionKey.OP_READ);<span class="comment">//reigster  select方法之前运行 。。</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (ClosedChannelException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        selector.wakeup();<span class="comment">//select</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;worker run method invoke....&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                selector.select();</span><br><span class="line"></span><br><span class="line">                <span class="type">Runnable</span> <span class="variable">poll</span> <span class="operator">=</span> runnables.poll();</span><br><span class="line">                <span class="keyword">if</span> (poll != <span class="literal">null</span>) &#123;</span><br><span class="line">                    poll.run();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                Iterator&lt;SelectionKey&gt; iterator = selector.selectedKeys().iterator();</span><br><span class="line">                <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">                    <span class="type">SelectionKey</span> <span class="variable">sckey</span> <span class="operator">=</span> iterator.next();</span><br><span class="line">                    iterator.remove();</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (sckey.isReadable()) &#123;</span><br><span class="line">                        <span class="type">SocketChannel</span> <span class="variable">sc</span> <span class="operator">=</span> (SocketChannel) sckey.channel();</span><br><span class="line">                        <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">30</span>);</span><br><span class="line">                        sc.read(buffer);</span><br><span class="line">                        buffer.flip();</span><br><span class="line">                        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> Charset.defaultCharset().decode(buffer).toString();</span><br><span class="line">                        System.out.println(<span class="string">&quot;result = &quot;</span> + result);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="5-3-零拷贝的问题"><a href="#5-3-零拷贝的问题" class="headerlink" title="5.3 零拷贝的问题"></a>5.3 零拷贝的问题</h5><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1.</span> 什么是零拷贝 【概念】</span><br></pre></td></tr></table></figure>









</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://example.com">Michael</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2023/10/17/Netty1/">http://example.com/2023/10/17/Netty1/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">Michael的小木屋</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="http:///p9.qhimg.com/t0163fa31dd6351bf12.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/10/17/Netty2/"><img class="prev-cover" src="http:///p2.qhimg.com/t010ad2c94c7a13a383.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Netty（下）</div></div></a></div><div class="next-post pull-right"><a href="/2023/10/11/Es/"><img class="next-cover" src="http:///p2.qhimg.com/t01d98f8b7d040b9f1d.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Es</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/./img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Michael</div><div class="author-info__description">后端学徒，记录学习</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">23</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/zyzstart" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="/1738091590@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E5%88%97%E8%AF%BE%E7%A8%8B-%E2%80%94-Netty%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91"><span class="toc-number">1.</span> <span class="toc-text">分布式系列课程 — Netty应用开发</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%BC%95%E8%A8%80"><span class="toc-number">1.1.</span> <span class="toc-text">1. 引言</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-%E4%BB%80%E4%B9%88%E6%98%AFNetty"><span class="toc-number">1.1.1.</span> <span class="toc-text">1.1 什么是Netty</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%AD%A6%E4%B9%A0Netty"><span class="toc-number">1.1.2.</span> <span class="toc-text">1.2 为什么要学习Netty</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-NIO%E7%BC%96%E7%A8%8B"><span class="toc-number">1.2.</span> <span class="toc-text">2. NIO编程</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1-%E4%BC%A0%E7%BB%9F%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1%E4%B8%AD%E7%9A%84%E5%BC%80%E5%8F%91%E6%96%B9%E5%BC%8F%E5%8F%8A%E9%97%AE%E9%A2%98"><span class="toc-number">1.2.1.</span> <span class="toc-text">2.1 传统网络通信中的开发方式及问题</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#2-1-1-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%89%88%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">2.1.1 多线程版网络编程</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2-1-2-%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%89%88%E7%9A%84%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">2.1.2 线程池版的网络编程</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-NIO%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1%E4%B8%AD%E7%9A%84%E9%9D%9E%E9%98%BB%E5%A1%9E%E7%BC%96%E7%A8%8B"><span class="toc-number">1.2.2.</span> <span class="toc-text">2.2 NIO网络通信中的非阻塞编程</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-NIO%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%BC%80%E5%8F%91%E6%96%B9%E5%BC%8F"><span class="toc-number">1.3.</span> <span class="toc-text">3.NIO的基本开发方式</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#3-1-Channel%E7%AE%80%E4%BB%8B"><span class="toc-number">1.3.0.1.</span> <span class="toc-text">3.1 Channel简介</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#3-2-Buffer%E7%AE%80%E4%BB%8B"><span class="toc-number">1.3.0.2.</span> <span class="toc-text">3.2 Buffer简介</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#3-4-%E7%AC%AC%E4%B8%80%E4%B8%AANIO%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90"><span class="toc-number">1.3.0.3.</span> <span class="toc-text">3.4 第一个NIO程序分析</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#3-5-NIO%E5%BC%80%E5%8F%91%E7%9A%84%E6%AD%A5%E9%AA%A4%E6%80%BB%E7%BB%93"><span class="toc-number">1.3.0.4.</span> <span class="toc-text">3.5 NIO开发的步骤总结</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-ByteBuffer%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.4.</span> <span class="toc-text">4. ByteBuffer详解</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#4-1-ByteBuffer%E6%98%AF%E6%8A%BD%E8%B1%A1%E7%B1%BB%EF%BC%8C%E4%BB%96%E7%9A%84%E4%B8%BB%E8%A6%81%E5%AE%9E%E7%8E%B0%E7%B1%BB%E4%B8%BA"><span class="toc-number">1.4.1.</span> <span class="toc-text">4.1 ByteBuffer是抽象类，他的主要实现类为</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-2-%E8%8E%B7%E5%8F%96%E6%96%B9%E5%BC%8F"><span class="toc-number">1.4.2.</span> <span class="toc-text">4.2 获取方式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-3-%E6%A0%B8%E5%BF%83%E7%BB%93%E6%9E%84"><span class="toc-number">1.4.3.</span> <span class="toc-text">4.3 核心结构</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-4-%E6%A0%B8%E5%BF%83API"><span class="toc-number">1.4.4.</span> <span class="toc-text">4.4 核心API</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-5-%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%93%8D%E4%BD%9C"><span class="toc-number">1.4.5.</span> <span class="toc-text">4.5 字符串操作</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%AD%98%E5%82%A8%E5%88%B0Buffer%E4%B8%AD"><span class="toc-number"></span> <span class="toc-text">字符串存储到Buffer中</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#4-6-%E7%B2%98%E5%8C%85%E4%B8%8E%E5%8D%8A%E5%8C%85"><span class="toc-number">0.0.1.</span> <span class="toc-text">4.6 粘包与半包</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-NIO%E7%9A%84%E5%BC%80%E5%8F%91%E4%BD%BF%E7%94%A8"><span class="toc-number">0.1.</span> <span class="toc-text">5. NIO的开发使用</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#5-1-%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C"><span class="toc-number">0.1.1.</span> <span class="toc-text">5.1 文件操作</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#5-1-1-%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9"><span class="toc-number">0.1.1.1.</span> <span class="toc-text">5.1.1 读取文件内容</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#5-1-2-%E5%86%99%E5%85%A5%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9"><span class="toc-number">0.1.1.2.</span> <span class="toc-text">5.1.2 写入文件内容</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#5-1-3-%E6%96%87%E4%BB%B6%E7%9A%84%E5%A4%8D%E5%88%B6"><span class="toc-number">0.1.1.3.</span> <span class="toc-text">5.1.3 文件的复制</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-2-%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B"><span class="toc-number">0.1.2.</span> <span class="toc-text">5.2 网络编程</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-3-%E9%9B%B6%E6%8B%B7%E8%B4%9D%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">0.1.3.</span> <span class="toc-text">5.3 零拷贝的问题</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/11/24/kafka/" title="Kafka"><img src="http:///p3.qhimg.com/t01e2fa62f505895db7.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Kafka"/></a><div class="content"><a class="title" href="/2023/11/24/kafka/" title="Kafka">Kafka</a><time datetime="2023-11-23T16:00:00.000Z" title="发表于 2023-11-24 00:00:00">2023-11-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/10/26/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" title="设计模式"><img src="https://images.pexels.com/photos/1563356/pexels-photo-1563356.jpeg?auto=compress&amp;cs=tinysrgb&amp;dpr=1&amp;w=500" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="设计模式"/></a><div class="content"><a class="title" href="/2023/10/26/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" title="设计模式">设计模式</a><time datetime="2023-10-25T16:00:00.000Z" title="发表于 2023-10-26 00:00:00">2023-10-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/10/26/%E8%AE%A4%E8%AF%81%E9%89%B4%E6%9D%83/" title="认证鉴权"><img src="https://images.pexels.com/photos/1563356/pexels-photo-1563356.jpeg?auto=compress&amp;cs=tinysrgb&amp;dpr=1&amp;w=500" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="认证鉴权"/></a><div class="content"><a class="title" href="/2023/10/26/%E8%AE%A4%E8%AF%81%E9%89%B4%E6%9D%83/" title="认证鉴权">认证鉴权</a><time datetime="2023-10-25T16:00:00.000Z" title="发表于 2023-10-26 00:00:00">2023-10-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/10/17/Netty2/" title="Netty（下）"><img src="http:///p2.qhimg.com/t010ad2c94c7a13a383.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Netty（下）"/></a><div class="content"><a class="title" href="/2023/10/17/Netty2/" title="Netty（下）">Netty（下）</a><time datetime="2023-10-16T16:00:00.000Z" title="发表于 2023-10-17 00:00:00">2023-10-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/10/17/Netty1/" title="Netty（上）"><img src="http:///p9.qhimg.com/t0163fa31dd6351bf12.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Netty（上）"/></a><div class="content"><a class="title" href="/2023/10/17/Netty1/" title="Netty（上）">Netty（上）</a><time datetime="2023-10-16T16:00:00.000Z" title="发表于 2023-10-17 00:00:00">2023-10-17</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('http:///p9.qhimg.com/t0163fa31dd6351bf12.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2024 By Michael</div><div class="footer_custom_text">Hi, welcome to my blog!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>